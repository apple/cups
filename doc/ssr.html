<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>CUPS Software Security Report</TITLE>
<META NAME="AUTHOR" CONTENT="Easy Software Products">
<META NAME="COPYRIGHT" CONTENT="Copyright 1997-2000, All Rights Reserved">
<META NAME="DOCNUMBER" CONTENT="CUPS-SSR-1.1">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<STYLE>
BODY { font-family: serif; font-size: 11.0pt }
H1 { font-family: sans-serif; font-size: 20.0pt }
H2 { font-family: sans-serif; font-size: 20.0pt }
H3 { font-family: sans-serif; font-size: 20.0pt }
H4 { font-family: sans-serif; font-size: 20.0pt }
H5 { font-family: sans-serif; font-size: 20.0pt }
H6 { font-family: sans-serif; font-size: 20.0pt }
SUB { font-size: 8.0pt }
SUP { font-size: 8.0pt }
PRE { font-size: 9.0pt }
</STYLE>
</HEAD>
<BODY>
<CENTER><A HREF="#CONTENTS"><IMG SRC="images/cups-large.gif" BORDER="0"><BR>
<H1>CUPS Software Security Report</H1></A><BR>
CUPS-SSR-1.1<BR>
Easy Software Products<BR>
Copyright 1997-2000, All Rights Reserved<BR>
</CENTER>
<HR>
<H1 ALIGN="CENTER"><A NAME="CONTENTS">Table of Contents</A></H1>
<BR>
<BR><B><A HREF="#1">1 Scope</A></B>
<UL>
<LI><A HREF="#1_1">1.1 Identification</A></LI>
<LI><A HREF="#1_2">1.2 System Overview</A></LI>
<LI><A HREF="#1_3">1.3 Document Overview</A></LI>
</UL>
<B><A HREF="#2">2 References</A></B>
<UL>
<LI><A HREF="#2_1">2.1 CUPS Documentation</A></LI>
<LI><A HREF="#2_2">2.2 Other Documents</A></LI>
</UL>
<B><A HREF="#3">3 Local Access Risks</A></B>
<UL>
<LI><A HREF="#3_1">3.1 Security Breaches</A></LI>
</UL>
<B><A HREF="#4">4 Remote Access Risks</A></B>
<UL>
<LI><A HREF="#4_1">4.1 Denial of Service Attacks</A></LI>
<LI><A HREF="#4_2">4.2 Security Breaches</A></LI>
</UL>
<HR>
<H1><A NAME="1">1 Scope</A></H1>
<H2><A NAME="1_1">1.1 Identification</A></H2>
 This software security report provides an analysis of possible 
security concerns for the Common UNIX Printing System (&quot;CUPS&quot;) Version 
1.1.
<H2><A NAME="1_2">1.2 System Overview</A></H2>
<P>The Common UNIX Printing System provides a portable printing layer 
for  UNIX&reg; operating systems. It has been developed by <A HREF="http://www.easysw.com">
Easy Software Products</A> to promote a standard printing solution for 
all UNIX vendors and users. CUPS provides the System V and Berkeley 
command-line interfaces. </P>
<P>CUPS uses the Internet Printing Protocol (IETF-IPP) as the basis for 
managing print jobs and queues. The Line Printer Daemon (LPD, RFC1179), 
Server Message Block (SMB), and AppSocket protocols are also supported 
with reduced functionality. </P>
<P>CUPS adds network printer browsing and PostScript Printer 
Description (&quot;PPD&quot;)-based printing options to support real world 
applications under UNIX. </P>
<P>CUPS also includes a customized version of GNU GhostScript 
(currently based off GNU GhostScript 5.50) and an image file RIP that 
is used to support non-PostScript printers. </P>
<H2><A NAME="1_3">1.3 Document Overview</A></H2>
<P>This software security report is organized into the following 
sections:</P>
<UL>
<LI>1 - Scope</LI>
<LI>2 - References</LI>
<LI>3 - Local Access Risks</LI>
<LI>4 - Remote Access Risks</LI>
<LI>A - Glossary</LI>
</UL>
<H1><A NAME="2">2 References</A></H1>
<H2><A NAME="2_1">2.1 CUPS Documentation</A></H2>
<P>The following CUPS documentation is referenced by this document: </P>
<UL>
<LI>CUPS-CMP-1.1: CUPS Configuration Management Plan </LI>
<LI>CUPS-IDD-1.1: CUPS System Interface Design Description </LI>
<LI>CUPS-SAM-1.1.x: CUPS Software Administrators Manual </LI>
<LI>CUPS-SDD-1.1: CUPS Software Design Description </LI>
<LI>CUPS-SPM-1.1: CUPS Software Programming Manual </LI>
<LI>CUPS-SSR-1.1: CUPS Software Security Report </LI>
<LI>CUPS-STP-1.1: CUPS Software Test Plan </LI>
<LI>CUPS-SUM-1.1.x: CUPS Software Users Manual </LI>
<LI>CUPS-SVD-1.1.x: CUPS Software Version Description </LI>
</UL>
<H2><A NAME="2_2">2.2 Other Documents</A></H2>
<P>The following non-CUPS documents are referenced by this document: </P>
<UL>
<LI>Adobe PostScript Printer Description File Format Specification, 
 Version 4.3. </LI>
<LI>Adobe PostScript Language Reference, Third Edition. </LI>
<LI>IPP: Job and Printer Set Operations </LI>
<LI>IPP/1.1: Encoding and Transport </LI>
<LI>IPP/1.1: Implementers Guide </LI>
<LI>IPP/1.1: Model and Semantics </LI>
<LI>RFC 1179, Line Printer Daemon Protocol </LI>
<LI>RFC 2567, Design Goals for an Internet Printing Protocol </LI>
<LI>RFC 2568, Rationale for the Structure of the Model and Protocol 
 for the Internet Printing Protocol </LI>
<LI>RFC 2569, Mapping between LPD and IPP Protocols </LI>
<LI>RFC 2616, Hypertext Transfer Protocol -- HTTP/1.1 </LI>
<LI>RFC 2617, HTTP Authentication: Basic and Digest Access 
 Authentication </LI>
</UL>
<H1><A NAME="3">3 Local Access Risks</A></H1>
<P>Local access risks are those that can be exploited only with a local 
user account. This section does not address issues related to 
dissemination of the root password or other security issues associated 
with the UNIX operating system. </P>
<H2><A NAME="3_1">3.1 Security Breaches</A></H2>
<P>There are two known security vulnerabilities with local access: </P>
<OL>
<LI>Since the default installation creates a world-readable  request 
directory, it is possible for local users to read the  contents of 
print files before they are printed. </LI>
<P>This problem can be alleviated by making the request  directory 
readable only by the user specified in the CUPS  configuration file. </P>
<LI>Device URIs are passed to backend filters in argv[0] and in  an 
environment variable. Since device URIs can contain  usernames and 
passwords it may be possible for a local user to  gain access to a 
remote resource. </LI>
<P>We recommend that any password-protected accounts used for  remote 
printing have limited access priviledges so that the  possible damages 
can be minimized. </P>
<P>The device URI is &quot;sanitized&quot; (the username and password are 
 removed) when sent to an IPP client so that a remote user  cannot 
exploit this vulnerability. </P>
</OL>
<H1><A NAME="4">4 Remote Access Risks</A></H1>
<P>Remote access risks are those that can be exploited without a local 
user account and/or from a remote system. This section does not address 
issues related to network or firewall security. </P>
<H2><A NAME="4_1">4.1 Denial of Service Attacks</A></H2>
<P>Like all Internet services, the CUPS server is vulnerable to denial 
of service attacks, including: </P>
<OL>
<LI>Establishing multiple connections to the server until the server 
 will accept no more. </LI>
<P>This cannot be protected against by the current software. It  is 
possible that future versions of the CUPS software could be  configured 
to limit the number of connections allowed from a  single host, however 
that still would not prevent a determined  attack. </P>
<LI>Repeatedly opening and closing connections to the server as fast 
 as possible. </LI>
<P>There is no easy way of protecting against this in the CUPS 
 software. If the attack is coming from outside the local  network it 
might be possible to filter such an attack, however  once the 
connection request has been received by the server it  must at least 
accept the connection to find out who is  connecting. </P>
<LI>Flooding the network with broadcast packets on port 631. </LI>
<P>It might be possible to disable browsing if this condition  is 
detected by the CUPS software, however if there are large  numbers of 
printers available on the network such an algorithm  might think that 
an attack was occurring when instead a valid  update was being 
received. </P>
<LI>Sending partial IPP requests; specifically, sending part of an 
 attribute value and then stopping transmission. </LI>
<P>The current code is structured to read and write the IPP  request 
data on-the-fly, so there is no easy way to protect  against this for 
large attribute values. </P>
<LI>Sending large/long print jobs to printers, preventing other users 
 from printing. </LI>
<P>There are limited facilities for protecting against large print 
 jobs (the <CODE>MaxRequestSize</CODE> attribute), however this will 
 not protect printers from malicious users and print files that 
 generate hundreds or thousands of pages. In general, we recommend 
 restricting printer access to known hosts or networks, and adding 
 user-level access control as needed for expensive printers. </P>
</OL>
<H2><A NAME="4_2">4.2 Security Breaches</A></H2>
<P>The current CUPS server only supports Basic authentication with 
usernames and passwords. This essentially places the clear text of the 
username and password on the network. Since CUPS uses the UNIX username 
and password account information, the authentication information could 
be used to gain access to accounts (possibly priviledged accounts) on 
the server. </P>
<P>The default CUPS configuration disables remote administration. We do 
not recommend that remote administration be enabled for all hosts, 
however if you have a trusted network or subnet access can be 
restricted accordingly. </P>
<P>The next minor release of CUPS will support Digest authentication of 
the entire message body using separate MD5-based username and password 
files. This will protect password information and prevent unauthorized 
access due to compromised account passwords. </P>
</BODY>
</HTML>
